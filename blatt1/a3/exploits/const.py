#! /usr/bin/env python3

import requests
import json

#host = "10.0.23.24"
host = "127.0.0.1"
port = "7777"
url = "http://{}:{}".format(host, port)

support_id = "1"
support_card = "1337000000000000"

class User():
    def __init__(self, name, pwd):
        # One session per user.
        self.session = requests.Session()

        self.name = name
        self.pwd = pwd

        # Initially empty.
        self.fname = ""
        self.sname = ""

        self.data = {
            "username": name,
            "password": pwd
        }

        # We always need them registered and logged in anyway...
        self.register()
        self.login()

    def get(self, path):
        return self.session.get(url + path)

    def post(self, path, data):
        return self.session.post(url + path, data=data)

    def register(self):
        return self.post("/register", self.data)

    def login(self):
        return self.post("/login", self.data)

    def cardregister(self):
        response = self.post("/index/cardregister", {"register":"true"})
        return json.loads(response.text)
    
    def set_name(self, fname, sname):
        self.fname = fname
        self.sname = sname

        return self.post("/settings", {"fname":fname, "sname":sname})
    
    def transfer(self, from_card, to_card, amount, message):
        data = {
            "from_card": from_card,
            "to_card": to_card,
            "amount": amount,
            "message": message
        }

        return self.post("/card2card/submit", data)